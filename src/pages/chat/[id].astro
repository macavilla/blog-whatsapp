---
import VistaMensajes from "../../layouts/VistaMensajes.astro";

import NombreChat from "../../components/chats/NombreChat.astro";
import CajaMensajesChat from "../../components/chats/CajaMensajesChat.astro";
import InputsChat from "../../components/chats/InputsChat.astro";

import formatearTelefono from "../../utils/formatearTelefono.js";

import chats from "../../data/chats.json"
import mensajes from "../../data/mensajes.json"

const entradaIndice = Number(Astro.params.id);
const esIndiceValido = !isNaN(entradaIndice) && chats[entradaIndice];
const indice = esIndiceValido ? entradaIndice : 0;
const chat = chats[indice];

const esContacto = Boolean(chat.nombreContacto);
const telefono = formatearTelefono(chat.numero);
const nombreChat = esContacto ? chat.nombreContacto : telefono;
const mensajesChat = mensajes[chat.id] || mensajes[0];

const grupo = chat.grupo || [];
const esGrupo = grupo.length !== 0;
const miembros = esGrupo ? grupo.map(i => chats[i]) : [];

---

<VistaMensajes>

    <NombreChat
      slot="contacto"
      id={chat.id}
      nombre={nombreChat}
    />

    <CajaMensajesChat
      slot="mensajes"
      mensajes={mensajesChat}
      miembros={miembros}
    />
    
    <InputsChat
      slot="inputs"
    />

</VistaMensajes>
